name: Primary Flickr to Insta Automation
run-name: "Primary Account - ${{ github.event_name == 'schedule' && 'Scheduled' || 'Manual' }} Run (${{ github.run_number }})"

# Primary Instagram account automation workflow
# Uses the centralized reusable workflow with primary-account environment
# Posts photos from Flickr album with AI-generated captions

on:
  # Scheduled automation - Daily posting at 18:13 UTC (20:13 CEST)
  schedule:
    - cron: '13 18 * * *'
    - cron: '17 20 * * *'   
    - cron: '21 09 * * *'

  # Manual execution with configuration options
  workflow_dispatch:
    inputs:
      dry_run:
        description: 'Test mode - validate photos and generate captions without posting to Instagram'
        type: boolean
        default: false
      show_stats:
        description: 'Display album statistics and posting progress without running automation'
        type: boolean
        default: false

# Prevent concurrent automation runs to avoid state conflicts
concurrency:
  group: social-media-automation-primary
  cancel-in-progress: false

# Permissions for Git-based state management and legacy compatibility
permissions:
  contents: read       # Read repository code and configuration
  issues: write       # For legacy GitHub Issues audit trail (if enabled)
  actions: write      # For workflow execution and artifact handling

jobs:
  automation:
    name: Execute Primary Account Automation
    uses: ./.github/workflows/social-automation.yml
    with:
      account_id: primary
      environment_name: primary-account        # Uses primary-account GitHub environment
      account_flag: ''                        # Primary account uses default CLI behavior
      caller_workflow: 'primary-flickr-to-insta.yml'
      dry_run: ${{ inputs.dry_run || false }}
      show_stats: ${{ inputs.show_stats || false }}
    secrets: inherit                          # Pass all repository and environment secrets
